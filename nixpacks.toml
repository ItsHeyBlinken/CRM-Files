# Nixpacks Configuration for Event Planner CRM
# This file configures the Nixpacks build process for deployment

# Specify Node.js version (use 20 to avoid EOL warning)
[variables]
NIXPACKS_NODE_VERSION = '20'

# Setup phase: Install additional packages if needed
[phases.setup]
nixPkgs = ['...']

# Install phase: Install all dependencies (including devDependencies for TypeScript)
[phases.install]
cmds = [
  'npm ci',
  'cd /app/server && npm install',
  'cd /app/client && npm install'
]

# Build phase: Build both client and server
# Build client first, then server
[phases.build]
cmds = [
  'cd /app/client && npm run build',
  'cd /app/server && npm run build'
]

# Start phase: Start the server
[start]
cmd = 'cd /app/server && node dist/index.js'

# Environment variables (can be overridden by VPS settings)
[env]
NODE_ENV = 'production'

